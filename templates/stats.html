{% extends 'layout.html' %}


{% block head_content%}
<title> StreamSnip </title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
{% endblock %}

{% block content %}
<center>
    <div class="container">
        <div class="row">
            <h1>{{user_count}} Unique Clippers </h1>
                <h1> {{clip_count}} clips on </h1>
                <h1> {{channel_count}} channels till now.</h1>
        </div>

        <div class="row">
            <h1>Clip User Piechart</h1>
            <canvas id="pieChart" width="700" height="700"></canvas>
        </div>
    </br></br></br></br></br>
        <div class="row">
            <canvas id="myChart" width="1000" height="800"></canvas>
        </div>
        <div class="row">
            <canvas id="speedChart" width="1600px" height="1200px"></canvas>
        </div>
        {% if clip_users %}
        <h1>
            Top Clippers
        </h1>
        <div class="row">
            {% for user in top_clippers %}
            <div class="col-md-4 col-lg-3">
                <a href="{{ user['link'] }}">
                    <div class="card" style="width: 100%;">
                        <img class="card-img-top" src="{{user['image']}}" alt="User Profile Picture">
                        <div class="card-body">
                            <h5 class="card-title">{{ user['name'] }}</h5>
                            <p class="card-text">{{ user['count'] }} Times</p>
                        </div>
                    </div>
                </a>
            </div>
        {% endfor %}
        </br></br></br></br></br>
        {% endif %}
    </div>
</center>
<script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var times = {{times|safe}};
    var counts = {{counts|safe}};
    // Convert datetime strings to Date objects
    var dateObjects = times.map(function (time) {
        return new Date(time);
    });
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: dateObjects.map(function (date) {
                // Format date as needed (this example uses default toString)
                return date.toLocaleDateString('en-GB');
            }),
            datasets: [{
                label: 'Clips on each day',
                data: counts,
                backgroundColor: 'rgba(75, 192, 192, 0.2)', // Adjust the color as needed
                borderColor: 'rgba(75, 192, 192, 1)', // Adjust the color as needed
                borderWidth: 1,
                fill: false // Do not fill area under the line
            }]
        },
        options: {}
    });
    // set chart size to 800 x 800
    myChart.canvas.parentNode.style.height = '850px';
    myChart.canvas.parentNode.style.width = '1200px';
    
    var ctx = document.getElementById('pieChart').getContext('2d');
    var users = {{clip_users|tojson}};
    
    var pieChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: users.map(subarray => subarray[1])
            }],
            labels: users.map(subarray => subarray[0])
        },
        options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: ''
              }
            }
        },
    });
    // set chart size to 800 x 800
    pieChart.canvas.parentNode.style.height = '800px';
    pieChart.canvas.parentNode.style.width = '800px';


    // multi line chart
    var speedCanvas = document.getElementById("speedChart");
    var rawData = {{streamer_trend_data|tojson}};
    var oglabels = {{streamers_labels|tojson}};
    var dates = {{streamers_trend_days|tojson}};
    var datasets = [];
    for (var i = 1; i < Object.keys(rawData).length; i++) {
        var key = Object.keys(rawData)[i];
        var dataset = {
            label: key,
            data: rawData[key],
        };
        datasets.push(dataset);
    }
    const data = {
        labels: dates,
        datasets: datasets
    };
    const config = {
        type: 'line',
        data: data,
        options: {
          responsive: true,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          stacked: false,
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
            },
          }
        },
      };
    var speedData = new Chart(speedCanvas, config);
    // set chart size to 800 x 800
    speedData.canvas.parentNode.style.height = '1200px';
    speedData.canvas.parentNode.style.width = '1600px';

</script>
{% endblock %}
